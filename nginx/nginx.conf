# nginx.conf

events {}

http {
    upstream go-crud-app {
            # Point to both app instances
        server go_crud_api_1:3000;
        server go_crud_api_2:3001;
    }

    server {
        listen 80;

        location / {
            proxy_pass http://go-crud-app;  # Use upstream to forward to Go API
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /health {
            proxy_pass http://go-crud-app/health;  # Health check route
        }
    }
}




# http {
#   upstream go_crud_api {
#     # Load balancing between the two Go API containers
#     server app:8080;  # app1 container inside Docker network
#   }

#   server {
#     listen 80;

#     location / {
#       proxy_pass http://go_crud_api;  # Proxy requests to the upstream defined above
#       proxy_set_header Host $host;
#       proxy_set_header X-Real-IP $remote_addr;
#       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#       proxy_set_header X-Forwarded-Proto $scheme;
#     }
#   }
# }